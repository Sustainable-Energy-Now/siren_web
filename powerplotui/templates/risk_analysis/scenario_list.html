{% extends 'risk_analysis/base.html' %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'risk_dashboard' %}">Risk Dashboard</a></li>
<li class="breadcrumb-item active">Scenarios</li>
{% endblock %}

{% block risk_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Risk Analysis by Scenario</h3>
    <div>
        <a href="{% url 'powermapui:display_scenarios' %}" class="btn btn-outline-secondary">
            <i class="bi bi-gear"></i> Manage Scenarios
        </a>
    </div>
</div>

<div class="alert alert-info mb-4">
    <i class="bi bi-info-circle"></i>
    Scenarios are managed in the <a href="{% url 'powermapui:display_scenarios' %}">Scenario Management</a> section.
    Select a scenario below to view or add risk events.
</div>

<!-- Scenarios Table -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Scenario Name</th>
                        <th>Description</th>
                        <th>Risk Events</th>
                        <th>Avg Inherent Risk</th>
                        <th>Avg Residual Risk</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in scenario_data %}
                    <tr>
                        <td>
                            <a href="{% url 'risk_scenario_detail' item.scenario.idscenarios %}">
                                {{ item.scenario.title }}
                            </a>
                        </td>
                        <td>{{ item.scenario.description|default:"-"|truncatewords:10 }}</td>
                        <td>
                            {% if item.event_count > 0 %}
                            <span class="badge bg-primary">{{ item.event_count }}</span>
                            {% else %}
                            <span class="text-muted">0</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.inherent_score %}
                            <span class="badge" style="background-color: {% if item.inherent_score >= 25 %}#e74c3c{% elif item.inherent_score >= 13 %}#e67e22{% elif item.inherent_score >= 7 %}#f1c40f{% else %}#27ae60{% endif %}; color: {% if item.inherent_score >= 7 and item.inherent_score < 13 %}black{% else %}white{% endif %};">
                                {{ item.inherent_score|floatformat:1 }}
                            </span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if item.residual_score %}
                            <span class="badge" style="background-color: {% if item.residual_score >= 25 %}#e74c3c{% elif item.residual_score >= 13 %}#e67e22{% elif item.residual_score >= 7 %}#f1c40f{% else %}#27ae60{% endif %}; color: {% if item.residual_score >= 7 and item.residual_score < 13 %}black{% else %}white{% endif %};">
                                {{ item.residual_score|floatformat:1 }}
                            </span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <a href="{% url 'risk_scenario_detail' item.scenario.idscenarios %}" class="btn btn-outline-primary" title="View Risk Events">
                                    View
                                </a>
                                <a href="{% url 'risk_event_create' item.scenario.idscenarios %}" class="btn btn-outline-success" title="Add Risk Event">
                                    Add Risk
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted py-4">
                            No scenarios found. <a href="{% url 'powermapui:display_scenarios' %}">Create a scenario</a> first.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}