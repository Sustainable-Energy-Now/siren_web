{% extends 'banner.html' %}
{% block content %}
<style>
    .full-width-container {
        width: 100%;
        max-width: 100%;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        gap: 2rem;
    }

    .content-panel {
        flex: 1;
        min-width: 0;  /* Prevents flex items from overflowing */
    }

    .left-panel {
        flex: 0 0 40%;  /* Takes up 40% of the container width */
    }

    .right-panel {
        flex: 0 0 60%;  /* Takes up 60% of the container width */
        position: sticky;
    }

    h1 {
        font-size: 2rem;
        margin-bottom: 1.5rem;
    }

    h2 {
        font-size: 1.5rem;
        margin: 1.5rem 0 1rem;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .full-width-container {
            flex-direction: column;
        }

        .left-panel, .right-panel {
            flex: 1 1 100%;
        }
    }
</style>

<div class="full-width-container">
    <div class="content-panel left-panel">
        <h1>WEM Monthly Average Price History</h1>

        <p>This 3D image shows average period wholesale energy prices in the WA
        Wholesale Electricity Market (WEM) ... are they increasing? Are they
        here to stay? Are they a good or bad thing? ...is the market broken?</p>

        <h2>Negative prices - Causal factors:</h2>
        <ol>
            <li>Rooftop solar pushes down operational demand.</li>
            <li>Generators bid to be dispatched on the lowest price for a smaller amount of energy.</li>
            <li>Coal generators must stay operational 24/7, bidding negative prices to be dispatched.</li>
            <li>Large-scale generation certificate (LGC) owners also bid in negative to receive LGCs, down to the level of $40-50 MWh.</li>
        </ol>

        <h2>So, what is the direction of travel?</h2>
        <p>As coal exits and LGCs expire (nominally 2030), there will be fewer
        negative prices. As battery storage ramps up, it will flatten out
        day-night price volatility, smoothing operational demand and introducing
        a new 'baseload power 2.0'.</p>

        <h2>Are negative prices good or bad?</h2>
        <p>They are simply a feature of the market transition, encouraging battery
        storage investments, favoring first movers, and partially eating its own
        lunch.</p>

        <p>Negative prices benefit users trading directly on the energy market,
        such as energy wholesalers, batteries, and heavy industry.</p>

        <p>There is an optimal amount of storage to flatten operational demand and
        reduce shortage risk, though current incentives may not drive investment
        at that level.</p>
    </div>

        <!-- Right panel with chart -->
        <div class="right-panel" id="myDiv">
            <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
            <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" charset="utf-8"></script>
            <script type="text/javascript">
                window.PLOTLYENV=window.PLOTLYENV || {};
                function createArray(N) {
                    let newArr = [];
                    for (let i = 1; i <= N; i++) {
                        newArr.push(i);
                    }
                    return newArr;
                }
                var avg_dirn = false;
                const z2 = {{ z_values|safe }};
                let x = createArray(48);
                var x_tickvals = {{ x_tickvals|safe }};
                let y = createArray(148);
                var y_tickvals = {{ y_tickvals|safe }};
                var y_textvals = {{ y_textvals|safe }};
                avg_dirn = true;
                var data2 = {
                    x: x,
                    y: y,
                    z: z2,
                    type: 'surface',
                    showscale: false,
                    reversescale: avg_dirn,
                    colorscale: 'Jet'
                };
                var layout = {
                    title: {
                        text: "WEM Price History (Avg.)<br><sup><sub>(Data derived from: https://data.wa.aemo.com.au/#reference-trading-price)</sub></sup>",
                        y: 0.85,
                        font: {
                            size: 25
                        }
                    },
                    scene: {
                        xaxis: {
                            title: "Hour of the Day",
                            tickmode: "array",
                            tickvals: x_tickvals,
                            ticktext: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                            autorange: "reversed"
                        },
                        yaxis: {
                            title: "Month",
                            tickmode: "array",
                            tickvals: y_tickvals,
                            ticktext: y_textvals
                        },
                        zaxis: {
                            title: "Price"
                        }
                    }
                }
                Plotly.newPlot('myDiv', [data2], layout);
            </script>
        </div>
</div>
{% endblock %}
