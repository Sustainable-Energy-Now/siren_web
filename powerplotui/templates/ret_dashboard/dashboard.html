<!-- templates/ret_dashboard/dashboard.html -->
{% extends 'scada/base.html' %}
{% load humanize %}
{% load math_filters %}

{% block title %}SWIS Renewable Energy Dashboard - {{ month_name }} {{ year }}{% endblock %}

{% block content %}
<header>
    <h1>SWIS Renewable Energy Dashboard</h1>
    <p style="color: #7f8c8d; font-size: 1.1em;">
        {{ month_name }} {{ year }}
    </p>
    <p style="color: #95a5a6; font-size: 0.95em;">
        Published: {{ performance.updated_at|date:"d F Y" }}
    </p>
</header>

<!-- Quick Navigation Links -->
<div style="margin: 20px 0; padding: 15px; background: #ecf0f1; border-radius: 8px; display: flex; gap: 15px; align-items: center;">
    <strong style="color: #2c3e50;">Other Reports:</strong>
    {% if 1 in completed_quarters %}
    <a href="{% url 'quarterly_report' year 1 %}"
        style="color: #3498db; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">ðŸ“ˆ
        Q1 Report</a>
    {% endif %}
    {% if 2 in completed_quarters %}
    <a href="{% url 'quarterly_report' year 2 %}"
        style="color: #3498db; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">ðŸ“ˆ
        Q2 Report</a>
    {% endif %}
    {% if 3 in completed_quarters %}
    <a href="{% url 'quarterly_report' year 3 %}"
        style="color: #3498db; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">ðŸ“ˆ
        Q3 Report</a>
    {% endif %}
    {% if 4 in completed_quarters %}
    <a href="{% url 'quarterly_report' year 4 %}"
        style="color: #3498db; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">ðŸ“ˆ
        Q4 Report</a>
    {% endif %}
    <a href="{% url 'annual_review' year %}" style="color: #3498db; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">ðŸ“‘ {{ year }} Annual Review</a>
    <a href="{% url 'ret_targets_list' %}" style="color: #27ae60; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">ðŸŽ¯ Manage Targets</a>
</div>

<!-- Period Selector -->
<div class="month-selector">
    <label for="month-select"><strong>Select Period:</strong></label>
    <select id="month-select" name="month">
        {% for m in available_months %}
        <option value="{{ m.value }}" {% if m.value == year|stringformat:"04d"|add:"-"|add:month|stringformat:"02d" %}selected{% endif %}>
            {{ m.label }}
        </option>
        {% endfor %}
    </select>
    <button onclick="loadDashboard()">View</button>
    <button onclick="window.print()" style="background: #95a5a6;">Print Report</button>
</div>

<!-- Monthly RE Performance -->
<div class="section-header">
    <h2>{{ month_name }} {{ year }} RE Performance</h2>
</div>

<div class="metric-grid">
    <!-- Monthly RE% Operational -->
    <div class="metric-card positive">
        <div class="metric-label">RE% (Operational Demand)</div>
        <div class="metric-value">{{ performance.re_percentage_operational|floatformat:1 }}%</div>
        <div class="metric-sublabel">
            {{ performance.operational_demand|floatformat:1 }} GWh operational demand
        </div>
        <div class="metric-change">
            {% if prev_year_performance %}
                {{ prev_year_performance.re_percentage_operational|floatformat:1 }}% in {{ year|add:"-1" }}
            {% endif %}
        </div>
    </div>
    
    <!-- Monthly RE% Underlying -->
    <div class="metric-card positive">
        <div class="metric-label">RE% (Underlying Demand)</div>
        <div class="metric-value">{{ performance.re_percentage_underlying|floatformat:1 }}%</div>
        <div class="metric-sublabel">
            {{ performance.underlying_demand|floatformat:1 }} GWh underlying demand
        </div>
        <div class="metric-change">
            {% if prev_year_performance %}
                {{ prev_year_performance.re_percentage_underlying|floatformat:1 }}% in {{ year|add:"-1" }}
            {% endif %}
        </div>
    </div>
</div>

<!-- Year to Date Summary -->
<div class="section-header">
    <h2>Year to Date</h2>
</div>

<div class="metric-grid">
    <!-- YTD RE Percentage - Operational -->
    <div class="metric-card {% if target_status.status == 'ahead' %}positive{% elif target_status.status == 'behind' %}warning{% else %}neutral{% endif %}">
        <div class="metric-label">YTD RE% (Operational)</div>
        <div class="metric-value">{{ ytd_summary.re_percentage_operational|floatformat:1 }}%</div>
        <div class="metric-sublabel">Grid-sent electricity</div>
    </div>
    
    <!-- YTD RE Percentage - Underlying -->
    <div class="metric-card {% if target_status.status == 'ahead' %}positive{% elif target_status.status == 'behind' %}warning{% else %}neutral{% endif %}">
        <div class="metric-label">YTD RE% (Underlying)</div>
        <div class="metric-value">{{ ytd_summary.re_percentage_underlying|floatformat:1 }}%</div>
        <div class="metric-sublabel">Including rooftop solar</div>
    </div>
    
    <!-- Target Status -->
    <div class="metric-card {% if target_status.status == 'ahead' %}positive{% elif target_status.status == 'behind' %}negative{% else %}neutral{% endif %}">
        <div class="metric-label">Target for {{ target.target_year }}</div>
        <div class="metric-value">{{ target.target_percentage|floatformat:1 }}%</div>
        <div class="metric-change">
            {{ target_status.message }}
        </div>
    </div>
    
    <!-- Emissions -->
    <div class="metric-card neutral">
        <div class="metric-label">YTD Emissions</div>
        <div class="metric-value">{{ ytd_summary.total_emissions|floatformat:0|intcomma }} t COâ‚‚-e</div>
        <div class="metric-change">
            {% if ytd_emissions_change %}
                {% if ytd_emissions_change < 0 %}âœ“{% else %}âš {% endif %}
                {{ ytd_emissions_change|floatformat:1 }}% vs {{ year|add:"-1" }}
            {% endif %}
        </div>
    </div>
</div>

<!-- Demand Definitions Info Box -->
<div class="info-box" style="background: #e3f2fd; border-left-color: #2196f3;">
    <h3 style="margin-top: 0;">Understanding Demand Measures</h3>
    <p style="margin-bottom: 0;">
        <strong>Operational Demand:</strong> Total consumption from grid sources. This represents electricity delivered through the grid.<br>
        <strong>Underlying Demand:</strong> Operational demand plus that part of household rooftop solar generation that is consumed by the household before export to the grid.
    </p>
</div>

<!-- Monthly Highlights -->
<div class="section-header">
    <h2>{{ month_name }} Highlights</h2>
</div>

<div class="info-box">
    <h3>Generation Mix</h3>
    
    <table class="stats-table" style="margin-top: 15px;">
        <thead>
            <tr>
                <th>Technology</th>
                <th class="value">Generation (GWh)</th>
                <th class="value">% of Operational</th>
                <th class="value">% of Underlying</th>
            </tr>
        </thead>
        <tbody>
            <tr class="renewable-row">
                <td><strong>Wind</strong></td>
                <td class="value">{{ performance.wind_generation|floatformat:1 }}</td>
                <td class="value">{{ performance.wind_generation|div:performance.operational_demand|mul:100|floatformat:1 }}%</td>
                <td class="value">{{ performance.wind_generation|div:performance.underlying_demand|mul:100|floatformat:1 }}%</td>
            </tr>
            <tr class="renewable-row">
                <td><strong>Solar (Utility)</strong></td>
                <td class="value">{{ performance.solar_generation|floatformat:1 }}</td>
                <td class="value">{{ performance.solar_generation|div:performance.operational_demand|mul:100|floatformat:1 }}%</td>
                <td class="value">{{ performance.solar_generation|div:performance.underlying_demand|mul:100|floatformat:1 }}%</td>
            </tr>
            <tr class="renewable-row">
                <td><strong>Solar (Rooftop)</strong></td>
                <td class="value">{{ performance.dpv_generation|floatformat:1 }}</td>
                <td class="value">â€”</td>
                <td class="value">{{ performance.dpv_generation|div:performance.underlying_demand|mul:100|floatformat:1 }}%</td>
            </tr>
            <tr class="renewable-row">
                <td><strong>Biomass</strong></td>
                <td class="value">{{ performance.biomass_generation|floatformat:1 }}</td>
                <td class="value">{{ performance.biomass_generation|div:performance.operational_demand|mul:100|floatformat:1 }}%</td>
                <td class="value">{{ performance.biomass_generation|div:performance.underlying_demand|mul:100|floatformat:1 }}%</td>
            </tr>
            <tr class="fossil-row">
                <td>Gas</td>
                <td class="value">{{ performance.gas_generation|floatformat:1 }}</td>
                <td class="value">{{ performance.gas_generation|div:performance.operational_demand|mul:100|floatformat:1 }}%</td>
                <td class="value">{{ performance.gas_generation|div:performance.underlying_demand|mul:100|floatformat:1 }}%</td>
            </tr>
            <tr class="fossil-row">
                <td>Coal</td>
                <td class="value">{{ performance.coal_generation|floatformat:1 }}</td>
                <td class="value">{{ performance.coal_generation|div:performance.operational_demand|mul:100|floatformat:1 }}%</td>
                <td class="value">{{ performance.coal_generation|div:performance.underlying_demand|mul:100|floatformat:1 }}%</td>
            </tr>
            {% if performance.storage_charge > 0 %}
            <tr class="info-row">
                <td><em>Storage Charge</em></td>
                <td class="value"><em>{{ performance.storage_charge|floatformat:1 }}</em></td>
                <td class="value" colspan="2"></td>
            </tr>
            {% endif %}
            {% if performance.storage_discharge > 0 %}
            <tr class="info-row">
                <td><em>Storage Discharge</em></td>
                <td class="value"><em>{{ performance.storage_discharge|floatformat:1 }}</em></td>
            </tr>
            {% endif %}
        </tbody>
        <tfoot>
            <tr style="background: #34495e; color: white;">
                <td><strong>Total RE%</strong></td>
                <td class="value">â€”</td>
                <td class="value"><strong>{{ performance.re_percentage_operational|floatformat:1 }}%</strong></td>
                <td class="value"><strong>{{ performance.re_percentage_underlying|floatformat:1 }}%</strong></td>
            </tr>
        </tfoot>
    </table>
</div>

<!-- Key Statistics -->
<div class="section-header">
    <h2>Key Statistics</h2>
</div>

<div class="metric-grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));">
    <div class="metric-card neutral">
        <div class="metric-label">Avg Grid Emissions Intensity</div>
        <div class="metric-value">{{ performance.emissions_intensity_kg_mwh|floatformat:2 }}</div>
        <div class="metric-sublabel">kg COâ‚‚-e/MWh</div>
    </div>
    
    {% if performance.best_re_hour_percentage %}
    <div class="metric-card positive">
        <div class="metric-label">Best Renewable Hour</div>
        <div class="metric-value">{{ performance.best_re_hour_percentage|floatformat:1 }}%</div>
        <div class="metric-sublabel">{{ performance.best_re_hour_datetime|date:"d M, g:i A" }}</div>
    </div>
    {% endif %}
    
    {% if performance.peak_demand_mw %}
    <div class="metric-card neutral">
        <div class="metric-label">Peak Demand</div>
        <div class="metric-value">{{ performance.peak_demand_mw|floatformat:0|intcomma }}</div>
        <div class="metric-sublabel">MW on {{ performance.peak_demand_datetime|date:"d M, g:i A" }}</div>
    </div>
    {% endif %}
    
    {% if performance.minimum_demand_mw %}
    <div class="metric-card neutral">
        <div class="metric-label">Minimum Demand</div>
        <div class="metric-value">{{ performance.minimum_demand_mw|floatformat:0|intcomma }}</div>
        <div class="metric-sublabel">MW on {{ performance.minimum_demand_datetime|date:"d M, g:i A" }}</div>
    </div>
    {% endif %}
</div>

<!-- Wholesale Price Statistics -->
{% if performance.wholesale_price_avg is not None %}
<div class="section-header">
    <h2>Wholesale Price Statistics</h2>
</div>

<div class="metric-grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));">
    <div class="metric-card neutral">
        <div class="metric-label">Average Price</div>
        <div class="metric-value">${{ performance.wholesale_price_avg|floatformat:2 }}</div>
        <div class="metric-sublabel">$/MWh</div>
        {% if prev_year_performance.wholesale_price_avg %}
        <div class="metric-change">
            ${{ prev_year_performance.wholesale_price_avg|floatformat:2 }}/MWh in {{ year|add:"-1" }}
        </div>
        {% endif %}
    </div>
    
    {% if performance.wholesale_price_max is not None %}
    <div class="metric-card {% if performance.wholesale_price_max > 300 %}warning{% else %}neutral{% endif %}">
        <div class="metric-label">Maximum Price</div>
        <div class="metric-value">${{ performance.wholesale_price_max|floatformat:2 }}</div>
        <div class="metric-sublabel">$/MWh</div>
        {% if performance.wholesale_price_max_datetime %}
        <div class="metric-change">{{ performance.wholesale_price_max_datetime|date:"d M, g:i A" }}</div>
        {% endif %}
    </div>
    {% endif %}
    
    {% if performance.wholesale_price_min is not None %}
    <div class="metric-card {% if performance.wholesale_price_min < 0 %}positive{% else %}neutral{% endif %}">
        <div class="metric-label">Minimum Price</div>
        <div class="metric-value">${{ performance.wholesale_price_min|floatformat:2 }}</div>
        <div class="metric-sublabel">$/MWh</div>
        {% if performance.wholesale_price_min_datetime %}
        <div class="metric-change">{{ performance.wholesale_price_min_datetime|date:"d M, g:i A" }}</div>
        {% endif %}
    </div>
    {% endif %}
    
    {% if performance.wholesale_price_std_dev is not None %}
    <div class="metric-card neutral">
        <div class="metric-label">Price Volatility (Std Dev)</div>
        <div class="metric-value">${{ performance.wholesale_price_std_dev|floatformat:2 }}</div>
        <div class="metric-sublabel">$/MWh</div>
    </div>
    {% endif %}
</div>

<!-- Price Events Summary -->
{% if performance.wholesale_negative_count is not None or performance.wholesale_spike_count is not None %}
<div class="metric-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); margin-top: 20px;">
    {% if performance.wholesale_negative_count is not None %}
    <div class="metric-card {% if performance.wholesale_negative_count > 0 %}positive{% else %}neutral{% endif %}">
        <div class="metric-label">Negative Price Intervals</div>
        <div class="metric-value">{{ performance.wholesale_negative_count|intcomma }}</div>
        <div class="metric-sublabel">trading intervals with price &lt; $0/MWh</div>
        {% if prev_year_performance.wholesale_negative_count is not None %}
        <div class="metric-change">
            {{ prev_year_performance.wholesale_negative_count|intcomma }} intervals in {{ year|add:"-1" }}
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    {% if performance.wholesale_spike_count is not None %}
    <div class="metric-card {% if performance.wholesale_spike_count > 0 %}warning{% else %}neutral{% endif %}">
        <div class="metric-label">Price Spike Intervals</div>
        <div class="metric-value">{{ performance.wholesale_spike_count|intcomma }}</div>
        <div class="metric-sublabel">trading intervals with price &gt; $300/MWh</div>
        {% if prev_year_performance.wholesale_spike_count is not None %}
        <div class="metric-change">
            {{ prev_year_performance.wholesale_spike_count|intcomma }} intervals in {{ year|add:"-1" }}
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endif %}

<!-- Wholesale Price Info Box -->
<div class="info-box" style="background: #fff3e0; border-left-color: #ff9800; margin-top: 20px;">
    <h3 style="margin-top: 0;">Understanding Wholesale Prices</h3>
    <p style="margin-bottom: 0;">
        <strong>Negative prices:</strong> Occur when renewable generation exceeds demand, incentivising storage charging and demand response.<br>
        <strong>Price spikes (&gt;$300/MWh):</strong> Typically occur during periods of high demand or low renewable generation, indicating grid stress.<br>
        <strong>Volatility:</strong> Higher standard deviation indicates more variable prices, which can affect investment decisions.
    </p>
</div>
{% endif %}

<!-- Charts -->
<div class="section-header">
    <h2>Visualizations</h2>
</div>

<!-- Generation Mix Charts - Side by Side -->
<div class="charts-grid">
    <div class="chart-container pie-chart-container">
        {{ generation_mix_operational_chart|safe }}
        <p class="chart-note">Excludes rooftop solar (DPV)</p>
    </div>
    
    <div class="chart-container pie-chart-container">
        {{ generation_mix_underlying_chart|safe }}
        <p class="chart-note">Includes rooftop solar (DPV)</p>
    </div>
</div>

<!-- Pathway Chart - Full Width -->
<div class="chart-container">
    <div class="chart-title">Pathway to 2040 Target</div>
    <p class="chart-subtitle">Based on Operational RE% (grid-sent electricity)</p>
    {{ pathway_chart|safe }}
</div>

<!-- New Capacity -->
{% if new_capacity %}
<div class="section-header">
    <h2>New Capacity</h2>
</div>

<div class="info-box">
    <h3>Commissioned in {{ month_name }}</h3>
    <ul class="bullet-list">
        {% for facility in new_capacity %}
        <li>
            <strong>âœ“ {{ facility.facility.facility_name }}</strong> - 
            {{ facility.capacity_mw|floatformat:0 }} MW 
            ({{ facility.commissioned_date|date:"d F Y" }})
        </li>
        {% endfor %}
    </ul>
    
    <p style="margin-top: 20px;"><strong>Total New Capacity {{ month_name }} {{ year }}: 
        {{ new_capacity|sum_attr:"capacity_mw"|floatformat:0 }} MW renewable</strong></p>
</div>
{% endif %}

{% if upcoming_capacity %}
<div class="info-box" style="margin-top: 20px;">
    <h3>Under Construction (Expected next 3 months)</h3>
    <ul class="bullet-list">
        {% for facility in upcoming_capacity %}
        <li>
            {{ facility.facility.facility_name }} - 
            {{ facility.capacity_mw|floatformat:0 }} MW 
            ({{ facility.expected_commissioning_date|date:"F Y" }})
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- Emissions Performance -->
<div class="section-header">
    <h2>Emissions Performance</h2>
</div>

<table class="stats-table">
    <thead>
        <tr>
            <th>Period</th>
            <th class="value">Total Emissions</th>
            <th class="value">Intensity</th>
            <th class="value">Change YoY</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>{{ month_name }} {{ year }}</strong></td>
            <td class="value">{{ performance.total_emissions_tonnes|floatformat:0|intcomma }} t COâ‚‚-e</td>
            <td class="value">{{ performance.emissions_intensity_kg_mwh|floatformat:2 }} kg/MWh</td>
            <td class="value">
                {% if emissions_change %}
                    {% if emissions_change < 0 %}âœ“{% else %}âš {% endif %}
                    {{ emissions_change|floatformat:1 }}%
                {% else %}
                    â€”
                {% endif %}
            </td>
        </tr>
        <tr>
            <td><strong>YTD {{ year }}</strong></td>
            <td class="value">{{ ytd_summary.total_emissions|floatformat:0|intcomma }} t COâ‚‚-e</td>
            <td class="value">{{ ytd_summary.emissions_intensity|floatformat:2 }} kg/MWh</td>
            <td class="value">
                {% if ytd_emissions_change %}
                    {% if ytd_emissions_change < 0 %}âœ“{% else %}âš {% endif %}
                    {{ ytd_emissions_change|floatformat:1 }}%
                {% else %}
                    â€”
                {% endif %}
            </td>
        </tr>
    </tbody>
</table>

<div class="section-header">
    <h2>What This Means</h2>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
    <div class="info-box">
        <h3>For Consumers</h3>
        <ul class="bullet-list">
            {% if emissions_change and emissions_change < 0 %}
            <li><strong>Lower emissions:</strong> Every kWh consumed in {{ month_name }} had 
                {{ emissions_change|mul:-1|floatformat:1 }}% lower carbon intensity than {{ month_name }} {{ year|add:"-1" }}</li>
            {% endif %}
            <li><strong>Grid renewables:</strong> {{ performance.re_percentage_operational|floatformat:0 }}% 
                of grid electricity came from zero-emission sources</li>
            <li><strong>Including rooftop:</strong> {{ performance.re_percentage_underlying|floatformat:0 }}% 
                of total electricity (grid + rooftop solar) was renewable</li>
            <li><strong>On track:</strong> Current trajectory will 
                {% if base_case_scenario.target_re_percentage >= 75 %}exceed{% else %}fall short of{% endif %} 
                75% renewable energy by 2040</li>
        </ul>
    </div>
    
    <div class="info-box">
        <h3>For the Grid</h3>
        <ul class="bullet-list">
            <li><strong>Growing integration challenge:</strong> Need more battery storage and grid flexibility</li>
            <li><strong>Strong performance:</strong> New wind and solar facilities performing at/above expectations</li>
            {% if performance.storage_discharge > 0 %}
            <li><strong>Storage value:</strong> BESS + Hydro avoided ~{{ performance.storage_discharge|floatformat:0 }} GWh 
                of curtailment this month</li>
            {% endif %}
            {% if performance.wholesale_negative_count and performance.wholesale_negative_count > 0 %}
            <li><strong>Negative pricing:</strong> {{ performance.wholesale_negative_count }} intervals of negative prices
                indicate opportunities for storage and demand response</li>
            {% endif %}
        </ul>
    </div>
</div>
{% include "ret_dashboard/partials/comments_section.html" with report_type="monthly" year=year month=month comments=comments %}
<!-- Footer -->
<div style="margin-top: 40px; padding: 20px; background: #ecf0f1; border-radius: 8px;">
    <p style="margin: 5px 0 0 0;">
        <strong></strong><a href="mailto:modelling.lead@sen.asn.au">Contact SEN Modelling</a></strong>
    </p>
</div>

<style>
.section-header {
    margin: 40px 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid #3498db;
}

.section-header h2 {
    color: #2c3e50;
    margin: 0;
}

.metric-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.metric-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid #bdc3c7;
}

.metric-card.positive {
    border-left-color: #27ae60;
    background: linear-gradient(135deg, #ffffff 0%, #e8f5e9 100%);
}

.metric-card.negative {
    border-left-color: #e74c3c;
    background: linear-gradient(135deg, #ffffff 0%, #ffebee 100%);
}

.metric-card.warning {
    border-left-color: #f39c12;
    background: linear-gradient(135deg, #ffffff 0%, #fff8e1 100%);
}

.metric-card.neutral {
    border-left-color: #3498db;
    background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
}

.metric-label {
    font-size: 0.9em;
    color: #7f8c8d;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
}

.metric-value {
    font-size: 2.5em;
    font-weight: 700;
    color: #2c3e50;
    margin: 10px 0;
}

.metric-sublabel {
    font-size: 0.85em;
    color: #95a5a6;
    margin-top: 8px;
}

.metric-change {
    font-size: 0.9em;
    color: #7f8c8d;
    margin-top: 8px;
}

.info-box {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 8px;
    margin: 20px 0;
    border-left: 4px solid #3498db;
}

.info-box h3 {
    color: #2c3e50;
    margin-top: 0;
    margin-bottom: 15px;
}

.bullet-list {
    list-style: none;
    padding-left: 0;
}

.bullet-list li {
    padding: 8px 0 8px 25px;
    position: relative;
    line-height: 1.6;
}

.bullet-list li:before {
    content: "â–ª";
    position: absolute;
    left: 5px;
    color: #3498db;
    font-size: 1.2em;
}

.stats-table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stats-table thead {
    background: #34495e;
    color: white;
}

.stats-table th,
.stats-table td {
    padding: 12px 15px;
    text-align: left;
}

.stats-table th.value,
.stats-table td.value {
    text-align: right;
}

.stats-table tbody tr:nth-child(even) {
    background: #f8f9fa;
}

.stats-table tbody tr:hover {
    background: #e8f4f8;
}

.stats-table tfoot td {
    padding: 12px 15px;
}

.renewable-row {
    background: #e8f5e9 !important;
}

.fossil-row {
    background: #fafafa !important;
}

.info-row {
    background: #e3f2fd !important;
    font-style: italic;
}

/* Charts Grid - Side by Side Layout */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin: 20px 0;
    width: 100%;
}

/* Responsive: Stack on smaller screens */
@media (max-width: 900px) {
    .charts-grid {
        grid-template-columns: 1fr;
    }
}

.chart-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    overflow: hidden;
}

/* Pie chart specific styling */
.pie-chart-container {
    min-height: 420px;
}

/* Force Plotly charts to respect container width */
.chart-container > div,
.pie-chart-container > div {
    width: 100% !important;
    max-width: 100% !important;
}

.chart-container .js-plotly-plot,
.chart-container .plotly,
.chart-container .plot-container,
.chart-container .svg-container {
    width: 100% !important;
    max-width: 100% !important;
}

.chart-note {
    font-size: 0.85em;
    color: #7f8c8d;
    text-align: center;
    margin: 10px 0 0 0;
    font-style: italic;
}

/* Remove margin for charts inside grid */
.charts-grid .chart-container {
    margin: 0;
}

.chart-title {
    font-size: 1.2em;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 5px;
}

.chart-subtitle {
    font-size: 0.9em;
    color: #7f8c8d;
    margin: 0 0 15px 0;
}

.month-selector {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.month-selector select,
.month-selector button {
    padding: 10px 15px;
    border: 1px solid #bdc3c7;
    border-radius: 6px;
    font-size: 1em;
}

.month-selector button {
    background: #3498db;
    color: white;
    border: none;
    cursor: pointer;
    transition: background 0.3s;
}

.month-selector button:hover {
    background: #2980b9;
}

@media print {
    .month-selector {
        display: none;
    }
    
    .metric-card {
        break-inside: avoid;
    }
    
    .charts-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .chart-container {
        break-inside: avoid;
    }
}
</style>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
function loadDashboard() {
    var selected = document.getElementById('month-select').value;
    var parts = selected.split('-');
    var year = parts[0];
    var month = parts[1];
    window.location.href = '/ret_dashboard/' + year + '/' + parseInt(month) + '/';
}

// Fix Plotly charts not respecting container width on initial render
document.addEventListener('DOMContentLoaded', function() {
    // Small delay to ensure Plotly has initialized
    setTimeout(function() {
        // Find all Plotly charts and trigger resize
        var plots = document.querySelectorAll('.js-plotly-plot');
        plots.forEach(function(plot) {
            if (window.Plotly) {
                Plotly.Plots.resize(plot);
            }
        });
    }, 100);
});

// Also resize on window load (catches cases where DOMContentLoaded is too early)
window.addEventListener('load', function() {
    setTimeout(function() {
        var plots = document.querySelectorAll('.js-plotly-plot');
        plots.forEach(function(plot) {
            if (window.Plotly) {
                Plotly.Plots.resize(plot);
            }
        });
    }, 200);
});
</script>
{% endblock %}