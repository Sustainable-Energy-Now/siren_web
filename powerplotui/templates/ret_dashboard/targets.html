<!-- templates/ret_dashboard/targets.html -->
{% extends 'scada/base.html' %}
{% load humanize %}

{% block title %}Renewable Energy Targets - SWIS{% endblock %}

{% block content %}
<header>
    <h1>Renewable Energy Targets</h1>
    <p style="color: #7f8c8d; font-size: 1.1em;">
        Manage RE% targets and 2040 projection scenarios
    </p>
</header>

<!-- Navigation Links -->
<div style="margin: 20px 0; padding: 15px; background: #ecf0f1; border-radius: 8px; display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
    <strong style="color: #2c3e50;">Navigation:</strong>
    <a href="{% url 'ret_dashboard' %}" style="color: #3498db; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">üìä Dashboard</a>
    <a href="#targets-section" style="color: #27ae60; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">üéØ Targets</a>
    <a href="#scenarios-section" style="color: #9b59b6; text-decoration: none; padding: 8px 15px; background: white; border-radius: 4px; font-weight: 500;">üìà Scenarios</a>
</div>

<!-- Messages -->
{% if messages %}
<div style="margin: 20px 0;">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}" style="padding: 15px; border-radius: 8px; margin-bottom: 10px; 
        {% if message.tags == 'success' %}background: #d4edda; border-left: 4px solid #27ae60; color: #155724;
        {% elif message.tags == 'error' %}background: #f8d7da; border-left: 4px solid #e74c3c; color: #721c24;
        {% else %}background: #d1ecf1; border-left: 4px solid #3498db; color: #0c5460;{% endif %}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Key Milestones Summary -->
<div class="section-header">
    <h2>Key Milestones</h2>
</div>

<div class="metric-grid">
    {% for milestone in milestones %}
    <div class="metric-card {% if milestone.is_interim_target %}neutral{% else %}positive{% endif %}">
        <div class="metric-label">{{ milestone.target_year }} Target</div>
        <div class="metric-value">{{ milestone.target_percentage|floatformat:0 }}%</div>
        <div class="metric-sublabel">
            {% if milestone.is_interim_target %}Interim Target{% else %}Major Target{% endif %}
        </div>
        {% if milestone.target_emissions_tonnes %}
        <div class="metric-change">{{ milestone.target_emissions_tonnes|floatformat:0|intcomma }} t CO‚ÇÇ-e</div>
        {% endif %}
    </div>
    {% empty %}
    <div class="info-box">
        <p>No milestone targets defined. Add targets for 2030, 2035, and 2040 below.</p>
    </div>
    {% endfor %}
</div>

<!-- =================================================================== -->
<!-- Renewable Energy Targets Section -->
<!-- =================================================================== -->

<div class="section-header" id="targets-section">
    <h2>RE Percentage Targets by Year</h2>
</div>

<!-- Add New Target Button -->
<div style="margin-bottom: 20px;">
    <button onclick="toggleModal('add-target-modal')" class="btn btn-primary">
        + Add New Target
    </button>
</div>

<!-- Targets Table -->
<div class="info-box">
    <table class="stats-table">
        <thead>
            <tr>
                <th>Year</th>
                <th class="value">RE Target (%)</th>
                <th class="value">Emissions Target (t)</th>
                <th>Description</th>
                <th class="value">Type</th>
                <th class="value">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for target in targets %}
            <tr class="{% if target.target_year == 2030 or target.target_year == 2040 %}renewable-row{% endif %}">
                <td><strong>{{ target.target_year }}</strong></td>
                <td class="value">{{ target.target_percentage|floatformat:1 }}%</td>
                <td class="value">
                    {% if target.target_emissions_tonnes %}
                        {{ target.target_emissions_tonnes|floatformat:0|intcomma }}
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>
                <td>{{ target.description|default:"‚Äî" }}</td>
                <td class="value">
                    {% if target.is_interim_target %}
                        <span class="badge badge-info">Interim</span>
                    {% else %}
                        <span class="badge badge-success">Major</span>
                    {% endif %}
                </td>
                <td class="value">
                    <button onclick="editTarget({{ target.id }}, {{ target.target_year }}, {{ target.target_percentage }}, '{{ target.target_emissions_tonnes|default_if_none:"" }}', '{{ target.description|default:""|escapejs }}', {{ target.is_interim_target|yesno:'true,false' }})" 
                            class="btn btn-small btn-edit" title="Edit">‚úèÔ∏è</button>
                    <button onclick="confirmDeleteTarget({{ target.id }}, {{ target.target_year }})" 
                            class="btn btn-small btn-delete" title="Delete">üóëÔ∏è</button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 30px; color: #7f8c8d;">
                    No targets defined yet. Click "Add New Target" to create one.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- =================================================================== -->
<!-- Target Scenarios Section -->
<!-- =================================================================== -->

<div class="section-header" id="scenarios-section">
    <h2>2040 Projection Scenarios</h2>
</div>

<!-- Add New Scenario Button -->
<div style="margin-bottom: 20px;">
    <button onclick="toggleModal('add-scenario-modal')" class="btn btn-primary">
        + Add New Scenario
    </button>
</div>

<!-- Scenarios Cards -->
<div class="scenario-grid">
    {% for item in scenarios_with_status %}
    <div class="scenario-card {% if item.scenario.is_active %}active{% else %}inactive{% endif %} {% if item.status.meets_target %}meets-target{% else %}below-target{% endif %}">
        <div class="scenario-header">
            <h3>{{ item.scenario.scenario_name }}</h3>
            <span class="scenario-type-badge {{ item.scenario.scenario_type }}">
                {{ item.scenario.get_scenario_type_display }}
            </span>
        </div>
        
        <div class="scenario-main-stat">
            <span class="stat-value">{{ item.scenario.projected_re_percentage_2040|floatformat:1 }}%</span>
            <span class="stat-label">Projected RE% by 2040</span>
        </div>
        
        <div class="scenario-status">
            {{ item.status.message }}
        </div>
        
        <div class="scenario-details">
            <div class="detail-row">
                <span class="detail-label">Wind:</span>
                <span class="detail-value">{{ item.scenario.wind_generation_2040|floatformat:0|intcomma }} GWh</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Solar (Utility):</span>
                <span class="detail-value">{{ item.scenario.solar_generation_2040|floatformat:0|intcomma }} GWh</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Solar (Rooftop):</span>
                <span class="detail-value">{{ item.scenario.dpv_generation_2040|floatformat:0|intcomma }} GWh</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Biomass:</span>
                <span class="detail-value">{{ item.scenario.biomass_generation_2040|floatformat:0|intcomma }} GWh</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Gas:</span>
                <span class="detail-value">{{ item.scenario.gas_generation_2040|floatformat:0|intcomma }} GWh</span>
            </div>
            <div class="detail-row total">
                <span class="detail-label">Total Generation:</span>
                <span class="detail-value">{{ item.total_generation|floatformat:0|intcomma }} GWh</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Emissions:</span>
                <span class="detail-value">{{ item.scenario.projected_emissions_2040_tonnes|floatformat:0|intcomma }} t</span>
            </div>
            {% if item.scenario.probability_percentage %}
            <div class="detail-row">
                <span class="detail-label">Probability:</span>
                <span class="detail-value">{{ item.scenario.probability_percentage|floatformat:0 }}%</span>
            </div>
            {% endif %}
        </div>
        
        {% if item.scenario.description %}
        <div class="scenario-description">
            {{ item.scenario.description }}
        </div>
        {% endif %}
        
        <div class="scenario-actions">
            <button onclick="editScenario({{ item.scenario.id }})" class="btn btn-small btn-edit" title="Edit">‚úèÔ∏è Edit</button>
            <form action="{% url 'scenario_toggle_active' item.scenario.id %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-small {% if item.scenario.is_active %}btn-warning{% else %}btn-success{% endif %}" title="Toggle Active">
                    {% if item.scenario.is_active %}‚è∏Ô∏è Deactivate{% else %}‚ñ∂Ô∏è Activate{% endif %}
                </button>
            </form>
            <button onclick="confirmDeleteScenario({{ item.scenario.id }}, '{{ item.scenario.scenario_name|escapejs }}')" 
                    class="btn btn-small btn-delete" title="Delete">üóëÔ∏è Delete</button>
        </div>
        
        <div class="scenario-meta">
            Last updated: {{ item.scenario.updated_at|date:"d M Y H:i" }}
        </div>
    </div>
    {% empty %}
    <div class="info-box" style="grid-column: 1 / -1;">
        <p style="text-align: center; padding: 20px; color: #7f8c8d;">
            No scenarios defined yet. Click "Add New Scenario" to create one.
        </p>
    </div>
    {% endfor %}
</div>

<!-- =================================================================== -->
<!-- Modals -->
<!-- =================================================================== -->

<!-- Add Target Modal -->
<div id="add-target-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add New RE Target</h3>
            <button onclick="toggleModal('add-target-modal')" class="modal-close">&times;</button>
        </div>
        <form action="{% url 'ret_target_create' %}" method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="target_year">Target Year *</label>
                <input type="number" name="target_year" id="target_year" required 
                       min="2020" max="2100" placeholder="e.g., 2030">
            </div>
            <div class="form-group">
                <label for="target_percentage">Target RE Percentage (%) *</label>
                <input type="number" name="target_percentage" id="target_percentage" required 
                       min="0" max="100" step="0.1" placeholder="e.g., 80">
            </div>
            <div class="form-group">
                <label for="target_emissions_tonnes">Target Emissions (tonnes CO‚ÇÇ-e)</label>
                <input type="number" name="target_emissions_tonnes" id="target_emissions_tonnes" 
                       min="0" step="1" placeholder="Optional">
            </div>
            <div class="form-group">
                <label for="description">Description</label>
                <textarea name="description" id="description" rows="3" 
                          placeholder="Optional description of this target"></textarea>
            </div>
            <div class="form-group checkbox-group">
                <label>
                    <input type="checkbox" name="is_interim_target">
                    This is an interim milestone target
                </label>
            </div>
            <div class="modal-actions">
                <button type="button" onclick="toggleModal('add-target-modal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Target</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Target Modal -->
<div id="edit-target-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit RE Target - <span id="edit-target-year-display"></span></h3>
            <button onclick="toggleModal('edit-target-modal')" class="modal-close">&times;</button>
        </div>
        <form id="edit-target-form" method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="edit_target_percentage">Target RE Percentage (%) *</label>
                <input type="number" name="target_percentage" id="edit_target_percentage" required 
                       min="0" max="100" step="0.1">
            </div>
            <div class="form-group">
                <label for="edit_target_emissions_tonnes">Target Emissions (tonnes CO‚ÇÇ-e)</label>
                <input type="number" name="target_emissions_tonnes" id="edit_target_emissions_tonnes" 
                       min="0" step="1">
            </div>
            <div class="form-group">
                <label for="edit_description">Description</label>
                <textarea name="description" id="edit_description" rows="3"></textarea>
            </div>
            <div class="form-group checkbox-group">
                <label>
                    <input type="checkbox" name="is_interim_target" id="edit_is_interim">
                    This is an interim milestone target
                </label>
            </div>
            <div class="modal-actions">
                <button type="button" onclick="toggleModal('edit-target-modal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Target Confirmation Modal -->
<div id="delete-target-modal" class="modal" style="display: none;">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <button onclick="toggleModal('delete-target-modal')" class="modal-close">&times;</button>
        </div>
        <p>Are you sure you want to delete the target for year <strong id="delete-target-year"></strong>?</p>
        <p style="color: #e74c3c; font-size: 0.9em;">This action cannot be undone.</p>
        <form id="delete-target-form" method="post">
            {% csrf_token %}
            <div class="modal-actions">
                <button type="button" onclick="toggleModal('delete-target-modal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-danger">Delete Target</button>
            </div>
        </form>
    </div>
</div>

<!-- Add Scenario Modal -->
<div id="add-scenario-modal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>Add New Scenario</h3>
            <button onclick="toggleModal('add-scenario-modal')" class="modal-close">&times;</button>
        </div>
        <form action="{% url 'scenario_create' %}" method="post">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label for="scenario_name">Scenario Name *</label>
                    <input type="text" name="scenario_name" id="scenario_name" required 
                           placeholder="e.g., Base Case 2024">
                </div>
                <div class="form-group">
                    <label for="scenario_type">Scenario Type *</label>
                    <select name="scenario_type" id="scenario_type" required>
                        {% for value, label in scenario_type_choices %}
                        <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="scenario_description">Description</label>
                <textarea name="description" id="scenario_description" rows="2" 
                          placeholder="Describe the assumptions for this scenario"></textarea>
            </div>
            
            <h4 style="margin: 20px 0 15px; color: #2c3e50; border-bottom: 1px solid #ecf0f1; padding-bottom: 10px;">
                2040 Projections
            </h4>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="projected_re_percentage_2040">Projected RE% *</label>
                    <input type="number" name="projected_re_percentage_2040" id="projected_re_percentage_2040" 
                           required min="0" max="100" step="0.1" placeholder="e.g., 85">
                </div>
                <div class="form-group">
                    <label for="projected_emissions_2040_tonnes">Projected Emissions (t) *</label>
                    <input type="number" name="projected_emissions_2040_tonnes" id="projected_emissions_2040_tonnes" 
                           required min="0" step="1" placeholder="e.g., 5000000">
                </div>
            </div>
            
            <h4 style="margin: 20px 0 15px; color: #2c3e50; border-bottom: 1px solid #ecf0f1; padding-bottom: 10px;">
                Generation Mix (GWh)
            </h4>
            
            <div class="form-row form-row-3">
                <div class="form-group">
                    <label for="wind_generation_2040">Wind</label>
                    <input type="number" name="wind_generation_2040" id="wind_generation_2040" 
                           min="0" step="1" value="0">
                </div>
                <div class="form-group">
                    <label for="solar_generation_2040">Solar (Utility)</label>
                    <input type="number" name="solar_generation_2040" id="solar_generation_2040" 
                           min="0" step="1" value="0">
                </div>
                <div class="form-group">
                    <label for="dpv_generation_2040">Solar (Rooftop)</label>
                    <input type="number" name="dpv_generation_2040" id="dpv_generation_2040" 
                           min="0" step="1" value="0">
                </div>
            </div>
            <div class="form-row form-row-3">
                <div class="form-group">
                    <label for="biomass_generation_2040">Biomass</label>
                    <input type="number" name="biomass_generation_2040" id="biomass_generation_2040" 
                           min="0" step="1" value="0">
                </div>
                <div class="form-group">
                    <label for="gas_generation_2040">Gas</label>
                    <input type="number" name="gas_generation_2040" id="gas_generation_2040" 
                           min="0" step="1" value="0">
                </div>
                <div class="form-group">
                    <label for="probability_percentage">Probability (%)</label>
                    <input type="number" name="probability_percentage" id="probability_percentage" 
                           min="0" max="100" step="1" placeholder="Optional">
                </div>
            </div>
            
            <div class="form-group checkbox-group">
                <label>
                    <input type="checkbox" name="is_active" checked>
                    Scenario is active
                </label>
            </div>
            
            <div class="modal-actions">
                <button type="button" onclick="toggleModal('add-scenario-modal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Scenario</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Scenario Modal -->
<div id="edit-scenario-modal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3>Edit Scenario</h3>
            <button onclick="toggleModal('edit-scenario-modal')" class="modal-close">&times;</button>
        </div>
        <form id="edit-scenario-form" method="post">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group">
                    <label for="edit_scenario_name">Scenario Name *</label>
                    <input type="text" name="scenario_name" id="edit_scenario_name" required>
                </div>
                <div class="form-group">
                    <label for="edit_scenario_type">Scenario Type *</label>
                    <select name="scenario_type" id="edit_scenario_type" required>
                        {% for value, label in scenario_type_choices %}
                        <option value="{{ value }}">{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="edit_scenario_description">Description</label>
                <textarea name="description" id="edit_scenario_description" rows="2"></textarea>
            </div>
            
            <h4 style="margin: 20px 0 15px; color: #2c3e50; border-bottom: 1px solid #ecf0f1; padding-bottom: 10px;">
                2040 Projections
            </h4>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="edit_projected_re_percentage_2040">Projected RE% *</label>
                    <input type="number" name="projected_re_percentage_2040" id="edit_projected_re_percentage_2040" 
                           required min="0" max="100" step="0.1">
                </div>
                <div class="form-group">
                    <label for="edit_projected_emissions_2040_tonnes">Projected Emissions (t) *</label>
                    <input type="number" name="projected_emissions_2040_tonnes" id="edit_projected_emissions_2040_tonnes" 
                           required min="0" step="1">
                </div>
            </div>
            
            <h4 style="margin: 20px 0 15px; color: #2c3e50; border-bottom: 1px solid #ecf0f1; padding-bottom: 10px;">
                Generation Mix (GWh)
            </h4>
            
            <div class="form-row form-row-3">
                <div class="form-group">
                    <label for="edit_wind_generation_2040">Wind</label>
                    <input type="number" name="wind_generation_2040" id="edit_wind_generation_2040" min="0" step="1">
                </div>
                <div class="form-group">
                    <label for="edit_solar_generation_2040">Solar (Utility)</label>
                    <input type="number" name="solar_generation_2040" id="edit_solar_generation_2040" min="0" step="1">
                </div>
                <div class="form-group">
                    <label for="edit_dpv_generation_2040">Solar (Rooftop)</label>
                    <input type="number" name="dpv_generation_2040" id="edit_dpv_generation_2040" min="0" step="1">
                </div>
            </div>
            <div class="form-row form-row-3">
                <div class="form-group">
                    <label for="edit_biomass_generation_2040">Biomass</label>
                    <input type="number" name="biomass_generation_2040" id="edit_biomass_generation_2040" min="0" step="1">
                </div>
                <div class="form-group">
                    <label for="edit_gas_generation_2040">Gas</label>
                    <input type="number" name="gas_generation_2040" id="edit_gas_generation_2040" min="0" step="1">
                </div>
                <div class="form-group">
                    <label for="edit_probability_percentage">Probability (%)</label>
                    <input type="number" name="probability_percentage" id="edit_probability_percentage" 
                           min="0" max="100" step="1">
                </div>
            </div>
            
            <div class="form-group checkbox-group">
                <label>
                    <input type="checkbox" name="is_active" id="edit_is_active">
                    Scenario is active
                </label>
            </div>
            
            <div class="modal-actions">
                <button type="button" onclick="toggleModal('edit-scenario-modal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Scenario Confirmation Modal -->
<div id="delete-scenario-modal" class="modal" style="display: none;">
    <div class="modal-content modal-small">
        <div class="modal-header">
            <h3>Confirm Delete</h3>
            <button onclick="toggleModal('delete-scenario-modal')" class="modal-close">&times;</button>
        </div>
        <p>Are you sure you want to delete the scenario "<strong id="delete-scenario-name"></strong>"?</p>
        <p style="color: #e74c3c; font-size: 0.9em;">This action cannot be undone.</p>
        <form id="delete-scenario-form" method="post">
            {% csrf_token %}
            <div class="modal-actions">
                <button type="button" onclick="toggleModal('delete-scenario-modal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-danger">Delete Scenario</button>
            </div>
        </form>
    </div>
</div>

<style>
/* Base styles matching dashboard.html */
.section-header {
    margin: 40px 0 20px 0;
    padding-bottom: 10px;
    border-bottom: 2px solid #3498db;
}

.section-header h2 {
    color: #2c3e50;
    margin: 0;
}

.metric-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
}

.metric-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid #bdc3c7;
}

.metric-card.positive {
    border-left-color: #27ae60;
    background: linear-gradient(135deg, #ffffff 0%, #e8f5e9 100%);
}

.metric-card.neutral {
    border-left-color: #3498db;
    background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
}

.metric-label {
    font-size: 0.9em;
    color: #7f8c8d;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
}

.metric-value {
    font-size: 2.5em;
    font-weight: 700;
    color: #2c3e50;
    margin: 10px 0;
}

.metric-sublabel {
    font-size: 0.85em;
    color: #95a5a6;
    margin-top: 8px;
}

.metric-change {
    font-size: 0.9em;
    color: #7f8c8d;
    margin-top: 8px;
}

.info-box {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 8px;
    margin: 20px 0;
    border-left: 4px solid #3498db;
}

.stats-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stats-table thead {
    background: #34495e;
    color: white;
}

.stats-table th,
.stats-table td {
    padding: 12px 15px;
    text-align: left;
}

.stats-table th.value,
.stats-table td.value {
    text-align: right;
}

.stats-table tbody tr:nth-child(even) {
    background: #f8f9fa;
}

.stats-table tbody tr:hover {
    background: #e8f4f8;
}

.renewable-row {
    background: #e8f5e9 !important;
}

/* Buttons */
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    font-size: 1em;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 500;
}

.btn-primary {
    background: #3498db;
    color: white;
}

.btn-primary:hover {
    background: #2980b9;
}

.btn-secondary {
    background: #95a5a6;
    color: white;
}

.btn-secondary:hover {
    background: #7f8c8d;
}

.btn-danger {
    background: #e74c3c;
    color: white;
}

.btn-danger:hover {
    background: #c0392b;
}

.btn-success {
    background: #27ae60;
    color: white;
}

.btn-success:hover {
    background: #229954;
}

.btn-warning {
    background: #f39c12;
    color: white;
}

.btn-warning:hover {
    background: #d68910;
}

.btn-small {
    padding: 5px 10px;
    font-size: 0.85em;
}

.btn-edit {
    background: #3498db;
    color: white;
}

.btn-delete {
    background: #e74c3c;
    color: white;
}

/* Badges */
.badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: 600;
}

.badge-success {
    background: #27ae60;
    color: white;
}

.badge-info {
    background: #3498db;
    color: white;
}

/* Scenario Cards */
.scenario-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
    margin: 20px 0;
}

.scenario-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
}

.scenario-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.scenario-card.inactive {
    opacity: 0.7;
    background: #f5f5f5;
}

.scenario-card.meets-target {
    border-top: 4px solid #27ae60;
}

.scenario-card.below-target {
    border-top: 4px solid #e74c3c;
}

.scenario-header {
    padding: 20px;
    background: #34495e;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.scenario-header h3 {
    margin: 0;
    font-size: 1.2em;
    color: white;
}

.scenario-type-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75em;
    font-weight: 600;
    text-transform: uppercase;
}

.scenario-type-badge.base_case {
    background: #3498db;
}

.scenario-type-badge.high_electrification {
    background: #9b59b6;
}

.scenario-type-badge.delayed_pipeline {
    background: #e67e22;
}

.scenario-type-badge.accelerated_pipeline {
    background: #27ae60;
}

.scenario-main-stat {
    padding: 25px;
    text-align: center;
    background: linear-gradient(135deg, #ffffff 0%, #e3f2fd 100%);
}

.scenario-main-stat .stat-value {
    font-size: 3em;
    font-weight: 700;
    color: #2c3e50;
    display: block;
}

.scenario-main-stat .stat-label {
    font-size: 0.9em;
    color: #7f8c8d;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.scenario-status {
    padding: 12px 20px;
    text-align: center;
    font-weight: 600;
    font-size: 0.95em;
}

.scenario-card.meets-target .scenario-status {
    background: #e8f5e9;
    color: #27ae60;
}

.scenario-card.below-target .scenario-status {
    background: #ffebee;
    color: #e74c3c;
}

.scenario-details {
    padding: 20px;
    border-top: 1px solid #ecf0f1;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #f5f5f5;
}

.detail-row:last-child {
    border-bottom: none;
}

.detail-row.total {
    font-weight: 600;
    background: #f8f9fa;
    margin: 10px -20px;
    padding: 10px 20px;
}

.detail-label {
    color: #7f8c8d;
}

.detail-value {
    color: #2c3e50;
    font-weight: 500;
}

.scenario-description {
    padding: 15px 20px;
    background: #f8f9fa;
    color: #7f8c8d;
    font-size: 0.9em;
    border-top: 1px solid #ecf0f1;
}

.scenario-actions {
    padding: 15px 20px;
    background: #ecf0f1;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.scenario-meta {
    padding: 10px 20px;
    background: #f8f9fa;
    color: #95a5a6;
    font-size: 0.8em;
    text-align: right;
}

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.modal-content {
    background: white;
    border-radius: 12px;
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

.modal-content.modal-large {
    max-width: 700px;
}

.modal-content.modal-small {
    max-width: 400px;
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid #ecf0f1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #34495e;
    color: white;
    border-radius: 12px 12px 0 0;
}

.modal-header h3 {
    margin: 0;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5em;
    color: white;
    cursor: pointer;
    padding: 0;
    line-height: 1;
}

.modal-close:hover {
    color: #ecf0f1;
}

.modal-content form {
    padding: 25px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #2c3e50;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #bdc3c7;
    border-radius: 6px;
    font-size: 1em;
    transition: border-color 0.3s;
    box-sizing: border-box;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-color: #3498db;
    outline: none;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-row-3 {
    grid-template-columns: 1fr 1fr 1fr;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-weight: normal;
}

.checkbox-group input[type="checkbox"] {
    width: auto;
}

.modal-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    padding-top: 15px;
    border-top: 1px solid #ecf0f1;
    margin-top: 20px;
}

/* Responsive */
@media (max-width: 768px) {
    .form-row,
    .form-row-3 {
        grid-template-columns: 1fr;
    }
    
    .scenario-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        margin: 10px;
        max-height: 85vh;
    }
}
</style>

<script>
// Modal toggle function
function toggleModal(modalId) {
    var modal = document.getElementById(modalId);
    if (modal.style.display === 'none' || modal.style.display === '') {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    } else {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

// Close modal when clicking outside
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
});

// Edit Target function
function editTarget(id, year, percentage, emissions, description, isInterim) {
    document.getElementById('edit-target-year-display').textContent = year;
    document.getElementById('edit_target_percentage').value = percentage;
    document.getElementById('edit_target_emissions_tonnes').value = emissions;
    document.getElementById('edit_description').value = description;
    document.getElementById('edit_is_interim').checked = isInterim;
    document.getElementById('edit-target-form').action = '/ret_dashboard/targets/' + id + '/update/';
    toggleModal('edit-target-modal');
}

// Delete Target confirmation
function confirmDeleteTarget(id, year) {
    document.getElementById('delete-target-year').textContent = year;
    document.getElementById('delete-target-form').action = '/ret_dashboard/targets/' + id + '/delete/';
    toggleModal('delete-target-modal');
}

// Edit Scenario function
function editScenario(id) {
    // Fetch scenario data via API
    fetch('/api/ret_dashboard/scenarios/' + id + '/')
        .then(response => response.json())
        .then(data => {
            document.getElementById('edit_scenario_name').value = data.scenario_name;
            document.getElementById('edit_scenario_type').value = data.scenario_type;
            document.getElementById('edit_scenario_description').value = data.description || '';
            document.getElementById('edit_projected_re_percentage_2040').value = data.projected_re_percentage_2040;
            document.getElementById('edit_projected_emissions_2040_tonnes').value = data.projected_emissions_2040_tonnes;
            document.getElementById('edit_wind_generation_2040').value = data.wind_generation_2040;
            document.getElementById('edit_solar_generation_2040').value = data.solar_generation_2040;
            document.getElementById('edit_dpv_generation_2040').value = data.dpv_generation_2040;
            document.getElementById('edit_biomass_generation_2040').value = data.biomass_generation_2040;
            document.getElementById('edit_gas_generation_2040').value = data.gas_generation_2040;
            document.getElementById('edit_probability_percentage').value = data.probability_percentage || '';
            document.getElementById('edit_is_active').checked = data.is_active;
            document.getElementById('edit-scenario-form').action = '/ret_dashboard/scenarios/' + id + '/update/';
            toggleModal('edit-scenario-modal');
        })
        .catch(error => {
            console.error('Error fetching scenario:', error);
            alert('Error loading scenario data. Please try again.');
        });
}

// Delete Scenario confirmation
function confirmDeleteScenario(id, name) {
    document.getElementById('delete-scenario-name').textContent = name;
    document.getElementById('delete-scenario-form').action = '/ret_dashboard/scenarios/' + id + '/delete/';
    toggleModal('delete-scenario-modal');
}
</script>

{% endblock %}
