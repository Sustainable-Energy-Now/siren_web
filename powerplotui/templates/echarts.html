<!-- powerplotui/templates/echarts.html -->

{% extends 'powerplotui_base.html' %}

{% block powerplotui_content %}
  
<!-- Load Echarts library -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.1/dist/echarts.min.js"></script>

<!-- Create a container for the plot -->
<div id="analysis-plot" style="width: 800px; height: 600px;"></div>

<script>
    // Function to fetch data from the Django view
    function fetchAnalysisData() {
        const series_1 = '{{ series_1 }}';
        const series_2 = '{{ series_2 }}';
        const scenario = '{{ scenario }}';
        const variant = '{{ variant }}';

        const url = `/get_analysis_data/?series_1=${series_1}&series_2=${series_2}&scenario=${scenario}&variant=${variant}`;
        console.log('Fetching data from:', url);
        return fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error ${response.status}`);
                }
                return response.json();
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    // Function to create the Echarts plot
    function createAnalysisPlot(analysis_data) {
        const chartDom = document.getElementById('analysis-plot');
        const myChart = echarts.init(chartDom);

        const option = {
            title: {
                text: 'Analysis Plot'
            },
            legend: {
                data: [analysis_data[0].series_1_name, analysis_data[0].series_2_name]
            },
            xAxis: {
                type: 'category',
                data: analysis_data.map(item => item.stage)
            },
            yAxis: [
                {
                    type: 'value',
                    name: analysis_data[0].series_1_name,
                },
                {
                    type: 'value',
                    name: analysis_data[0].series_2_name,
                    position: 'right' // Position the second y-axis on the right
                }
            ],
            series: [
                {
                    name: analysis_data[0].series_1_name,
                    type: 'line',
                    data: analysis_data.map(item => item.series_1_value),
                    yAxisIndex: 0 // Bind this series to the first y-axis
                },
                {
                    name: analysis_data[0].series_2_name,
                    type: 'line',
                    data: analysis_data.map(item => item.series_2_value),
                    yAxisIndex: 1 // Bind this series to the second y-axis
                }
            ]
        };
        myChart.setOption(option);
    }

    // Call the fetchAnalysisData function
    fetchAnalysisData()
        .then(analysis_data => createAnalysisPlot(analysis_data))
        .catch(error => console.error('Error creating plot:', error));
</script>

{% endblock %}