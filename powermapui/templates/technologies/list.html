<!-- powermapui/templates/technologies/list.html -->
{% extends 'powermapui_base.html' %}

{% block powermapui_content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Technologies</h3>
    <div>
      <a href="{% url 'powermapui:technology_years_list' %}" class="btn btn-outline-secondary me-2">
        <i class="bi bi-calendar3"></i> Year Data
      </a>
      <a href="{% url 'powermapui:technology_create' %}" class="btn btn-primary">Add New Technology</a>
    </div>
  </div>

  <p>
    This displays all technologies in the system. Technologies define the types of generation and storage
    equipment that can be installed at facilities. Use the search and filters below to find specific technologies.
  </p>

  <!-- Search and Filter Form -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" class="row g-3">
        <div class="col-md-4">
          <label for="search" class="form-label">Search:</label>
          <input type="text" name="search" id="search" class="form-control"
                 value="{{ search_query }}" placeholder="Search by name, signature, or description">
        </div>
        <div class="col-md-3">
          <label for="category" class="form-label">Category:</label>
          <select name="category" id="category" class="form-select">
            <option value="">All Categories</option>
            {% for cat in categories %}
              <option value="{{ cat }}" {% if cat == category %}selected{% endif %}>
                {{ cat }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <label for="fuel_type" class="form-label">Fuel Type:</label>
          <select name="fuel_type" id="fuel_type" class="form-select">
            <option value="">All Fuel Types</option>
            {% for value, label in fuel_types %}
              <option value="{{ value }}" {% if value == fuel_type %}selected{% endif %}>
                {{ label }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-1 d-flex align-items-end">
          <button type="submit" class="btn btn-primary me-2">Filter</button>
        </div>
        <div class="col-md-1 d-flex align-items-end">
          {% if search_query or category or fuel_type %}
            <a href="{% url 'powermapui:technology_list' %}" class="btn btn-outline-secondary">Clear</a>
          {% endif %}
        </div>
      </form>
    </div>
  </div>

  <!-- Results Table -->
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Technology Name</th>
          <th>Signature</th>
          <th>Category</th>
          <th>Fuel Type</th>
          <th>Renewable</th>
          <th>Dispatchable</th>
          <th>Lifetime</th>
          <th>Emissions</th>
          <th>Year Records</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for technology in page_obj %}
          <tr>
            <td>
              <a href="{% url 'powermapui:technology_detail' technology.pk %}" class="text-decoration-none">
                {{ technology.technology_name }}
              </a>
            </td>
            <td><code>{{ technology.technology_signature }}</code></td>
            <td>
              {% if technology.category %}
                <span class="badge bg-secondary">{{ technology.category }}</span>
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ technology.fuel_type|default:"-" }}</td>
            <td>
              {% if technology.renewable %}
                <span class="badge bg-success">Yes</span>
              {% else %}
                <span class="badge bg-warning text-dark">No</span>
              {% endif %}
            </td>
            <td>
              {% if technology.dispatchable %}
                <span class="badge bg-info">Yes</span>
              {% else %}
                <span class="badge bg-light text-dark">No</span>
              {% endif %}
            </td>
            <td>
              {% if technology.lifetime %}
                {{ technology.lifetime|floatformat:0 }} yrs
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if technology.emissions %}
                {{ technology.emissions|floatformat:3 }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ technology.year_count }}</td>
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <a href="{% url 'powermapui:technology_detail' technology.pk %}"
                   class="btn btn-outline-primary" title="View Details">
                  View
                </a>
                <a href="{% url 'powermapui:technology_edit' technology.pk %}"
                   class="btn btn-outline-warning" title="Edit Technology">
                  Edit
                </a>
                <a href="{% url 'powermapui:technology_detail' technology.pk %}"
                   class="btn btn-outline-info" title="Display Edit Year Data">
                  Years
                </a>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="10" class="text-center text-muted py-4">
              No technologies found.
              {% if search_query or category or fuel_type %}
                <a href="{% url 'powermapui:technology_list' %}" class="btn btn-link">Clear filters</a>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
    <nav aria-label="Technologies pagination">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if fuel_type %}&fuel_type={{ fuel_type }}{% endif %}">
              &laquo; First
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if fuel_type %}&fuel_type={{ fuel_type }}{% endif %}">
              Previous
            </a>
          </li>
        {% endif %}

        <li class="page-item active">
          <span class="page-link">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
          </span>
        </li>

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if fuel_type %}&fuel_type={{ fuel_type }}{% endif %}">
              Next
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if fuel_type %}&fuel_type={{ fuel_type }}{% endif %}">
              Last &raquo;
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
{% endblock %}
