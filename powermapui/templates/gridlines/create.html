<!-- gridlines/create.html -->
{% extends 'powermapui_base.html' %}

{% block powermapui_content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Add New Grid Line</h3>
    <a href="{% url 'powermapui:gridlines_list' %}" class="btn btn-outline-secondary">Back to List</a>
  </div>

  <p>Enter the details for a new grid line. Grid lines represent transmission and distribution infrastructure. Fields marked with <span class="text-danger">*</span> are required.</p>

  <div class="row">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-body">
          <form method="post" novalidate>
            {% csrf_token %}
            
            <!-- Basic Information -->
            <h5 class="mb-3">Basic Information</h5>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="line_name" class="form-label">Line Name <span class="text-danger">*</span></label>
                <input type="text" 
                       class="form-control" 
                       id="line_name" 
                       name="line_name" 
                       value="{{ form_data.line_name|default:'' }}"
                       required>
                <div class="form-text">Unique identifier for this grid line</div>
              </div>
              <div class="col-md-6">
                <label for="line_code" class="form-label">Line Code <span class="text-danger">*</span></label>
                <input type="text" 
                       class="form-control" 
                       id="line_code" 
                       name="line_code" 
                       value="{{ form_data.line_code|default:'' }}"
                       required>
                <div class="form-text">Short code for the line</div>
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-md-4">
                <label for="line_type" class="form-label">Line Type <span class="text-danger">*</span></label>
                <select class="form-select" id="line_type" name="line_type" required>
                  <option value="">Select type</option>
                  {% for type_value, type_label in line_types %}
                    <option value="{{ type_value }}" 
                            {% if form_data.line_type == type_value %}selected{% endif %}>
                      {{ type_label }}
                    </option>
                  {% endfor %}
                </select>
                <div class="form-text">Type of transmission line</div>
              </div>
              <div class="col-md-4">
                <label for="voltage_level" class="form-label">Voltage Level (kV) <span class="text-danger">*</span></label>
                <input type="number" 
                       class="form-control" 
                       id="voltage_level" 
                       name="voltage_level" 
                       step="0.1" 
                       min="0"
                       value="{{ form_data.voltage_level|default:'' }}"
                       required>
                <div class="form-text">Voltage level in kilovolts</div>
              </div>
              <div class="col-md-4">
                <label for="active" class="form-label">Status</label>
                <div class="form-check form-switch mt-2">
                  <input class="form-check-input" type="checkbox" id="active" name="active" 
                         {% if form_data.active or not form_data %}checked{% endif %}>
                  <label class="form-check-label" for="active">Active</label>
                </div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Physical Characteristics -->
            <h5 class="mb-3">Physical Characteristics</h5>
            <div class="row mb-3">
              <div class="col-md-4">
                <label for="length_km" class="form-label">Length (km)</label>
                <input type="number" 
                       class="form-control" 
                       id="length_km" 
                       name="length_km" 
                       step="0.01" 
                       min="0"
                       value="{{ form_data.length_km|default:'' }}">
                <div class="form-text">Line length in kilometers</div>
              </div>
              <div class="col-md-4">
                <label for="resistance_per_km" class="form-label">Resistance (Ω/km)</label>
                <input type="number" 
                       class="form-control" 
                       id="resistance_per_km" 
                       name="resistance_per_km" 
                       step="0.0001" 
                       min="0"
                       value="{{ form_data.resistance_per_km|default:'' }}">
                <div class="form-text">Resistance per kilometer</div>
              </div>
              <div class="col-md-4">
                <label for="reactance_per_km" class="form-label">Reactance (Ω/km)</label>
                <input type="number" 
                       class="form-control" 
                       id="reactance_per_km" 
                       name="reactance_per_km" 
                       step="0.0001" 
                       min="0"
                       value="{{ form_data.reactance_per_km|default:'' }}">
                <div class="form-text">Reactance per kilometer</div>
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-md-6">
                <label for="conductance_per_km" class="form-label">Conductance (S/km)</label>
                <input type="number" 
                       class="form-control" 
                       id="conductance_per_km" 
                       name="conductance_per_km" 
                       step="0.000001" 
                       min="0"
                       value="{{ form_data.conductance_per_km|default:'0' }}">
                <div class="form-text">Conductance per kilometer (optional)</div>
              </div>
              <div class="col-md-6">
                <label for="susceptance_per_km" class="form-label">Susceptance (S/km)</label>
                <input type="number" 
                       class="form-control" 
                       id="susceptance_per_km" 
                       name="susceptance_per_km" 
                       step="0.000001" 
                       min="0"
                       value="{{ form_data.susceptance_per_km|default:'0' }}">
                <div class="form-text">Susceptance per kilometer (optional)</div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Capacity -->
            <h5 class="mb-3">Capacity</h5>
            <div class="row mb-4">
              <div class="col-md-6">
                <label for="thermal_capacity_mw" class="form-label">Thermal Capacity (MW)</label>
                <input type="number" 
                       class="form-control" 
                       id="thermal_capacity_mw" 
                       name="thermal_capacity_mw" 
                       step="0.1" 
                       min="0"
                       value="{{ form_data.thermal_capacity_mw|default:'' }}">
                <div class="form-text">Normal operating capacity</div>
              </div>
              <div class="col-md-6">
                <label for="emergency_capacity_mw" class="form-label">Emergency Capacity (MW)</label>
                <input type="number" 
                       class="form-control" 
                       id="emergency_capacity_mw" 
                       name="emergency_capacity_mw" 
                       step="0.1" 
                       min="0"
                       value="{{ form_data.emergency_capacity_mw|default:'' }}">
                <div class="form-text">Emergency operating capacity</div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Terminal Connections -->
            <h5 class="mb-3">Terminal Connections</h5>
            <div class="alert alert-info">
              <small><i class="bi bi-info-circle"></i> You can connect terminals now or later from the grid line detail page.</small>
            </div>
            <div class="row mb-4">
              <div class="col-md-6">
                <label for="from_terminal" class="form-label">From Terminal</label>
                <select class="form-select" id="from_terminal" name="from_terminal">
                  <option value="">Select terminal (optional)</option>
                  {% for terminal in terminals %}
                    <option value="{{ terminal.pk }}" 
                            {% if form_data.from_terminal == terminal.pk|stringformat:"s" %}selected{% endif %}>
                      {{ terminal.terminal_name }} ({{ terminal.primary_voltage_kv }} kV)
                    </option>
                  {% endfor %}
                </select>
                <div class="form-text">Line originates from this terminal</div>
              </div>
              <div class="col-md-6">
                <label for="to_terminal" class="form-label">To Terminal</label>
                <select class="form-select" id="to_terminal" name="to_terminal">
                  <option value="">Select terminal (optional)</option>
                  {% for terminal in terminals %}
                    <option value="{{ terminal.pk }}" 
                            {% if form_data.to_terminal == terminal.pk|stringformat:"s" %}selected{% endif %}>
                      {{ terminal.terminal_name }} ({{ terminal.primary_voltage_kv }} kV)
                    </option>
                  {% endfor %}
                </select>
                <div class="form-text">Line terminates at this terminal</div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Geographic Coordinates -->
            <h5 class="mb-3">Geographic Coordinates</h5>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="from_latitude" class="form-label">From Latitude</label>
                <input type="number" 
                       class="form-control" 
                       id="from_latitude" 
                       name="from_latitude" 
                       step="0.000001" 
                       min="-90" 
                       max="90"
                       value="{{ form_data.from_latitude|default:'' }}">
                <div class="form-text">Starting point latitude</div>
              </div>
              <div class="col-md-6">
                <label for="from_longitude" class="form-label">From Longitude</label>
                <input type="number" 
                       class="form-control" 
                       id="from_longitude" 
                       name="from_longitude" 
                       step="0.000001" 
                       min="-180" 
                       max="180"
                       value="{{ form_data.from_longitude|default:'' }}">
                <div class="form-text">Starting point longitude</div>
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-md-6">
                <label for="to_latitude" class="form-label">To Latitude</label>
                <input type="number" 
                       class="form-control" 
                       id="to_latitude" 
                       name="to_latitude" 
                       step="0.000001" 
                       min="-90" 
                       max="90"
                       value="{{ form_data.to_latitude|default:'' }}">
                <div class="form-text">Ending point latitude</div>
              </div>
              <div class="col-md-6">
                <label for="to_longitude" class="form-label">To Longitude</label>
                <input type="number" 
                       class="form-control" 
                       id="to_longitude" 
                       name="to_longitude" 
                       step="0.000001" 
                       min="-180" 
                       max="180"
                       value="{{ form_data.to_longitude|default:'' }}">
                <div class="form-text">Ending point longitude</div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Additional Information -->
            <h5 class="mb-3">Additional Information</h5>
            <div class="mb-4">
              <label for="owner" class="form-label">Owner</label>
              <input type="text" 
                     class="form-control" 
                     id="owner" 
                     name="owner" 
                     value="{{ form_data.owner|default:'' }}">
              <div class="form-text">Line owner organization</div>
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">Create Grid Line</button>
              <a href="{% url 'powermapui:gridlines_list' %}" class="btn btn-outline-secondary">Cancel</a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <!-- Help Card -->
      <div class="card">
        <div class="card-header">
          <h6 class="mb-0">Field Guidelines</h6>
        </div>
        <div class="card-body">
          <div class="small">
            <p><strong>Line Name:</strong> Use a descriptive, unique name (e.g., "North-South 330kV Line").</p>
            
            <p><strong>Line Code:</strong> Short alphanumeric code (e.g., "NS330", "LINE01").</p>
            
            <p><strong>Voltage Level:</strong> Must match or be close to terminal voltages for proper connections.</p>
            
            <p><strong>Resistance & Reactance:</strong> Typical values:
              <ul class="mb-0">
                <li>132 kV: R=0.05-0.15 Ω/km, X=0.3-0.4 Ω/km</li>
                <li>330 kV: R=0.01-0.05 Ω/km, X=0.25-0.35 Ω/km</li>
              </ul>
            </p>
            
            <p><strong>Thermal Capacity:</strong> Typical ranges:
              <ul class="mb-0">
                <li>132 kV: 100-300 MW</li>
                <li>220 kV: 300-600 MW</li>
                <li>330 kV: 600-1200 MW</li>
              </ul>
            </p>
          </div>
        </div>
      </div>

      <!-- Examples Card -->
      <div class="card mt-3">
        <div class="card-header">
          <h6 class="mb-0">Example Grid Lines</h6>
        </div>
        <div class="card-body">
          <div class="small">
            <p><strong>330 kV Transmission:</strong></p>
            <ul class="small">
              <li>Type: Transmission</li>
              <li>Voltage: 330 kV</li>
              <li>Length: 50-150 km</li>
              <li>Capacity: 800-1000 MW</li>
              <li>R: 0.03 Ω/km, X: 0.3 Ω/km</li>
            </ul>
            
            <p><strong>132 kV Sub-transmission:</strong></p>
            <ul class="small">
              <li>Type: Sub-transmission</li>
              <li>Voltage: 132 kV</li>
              <li>Length: 20-50 km</li>
              <li>Capacity: 200-300 MW</li>
              <li>R: 0.08 Ω/km, X: 0.35 Ω/km</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}