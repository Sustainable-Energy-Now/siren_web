<!-- wind_turbines/list.html -->
{% extends 'powermapui_base.html' %}

{% block powermapui_content %}
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Wind Turbines</h3>
    <a href="{% url 'powermapui:wind_turbine_create' %}" class="btn btn-primary">Add New Wind Turbine</a>
  </div>

  <p>
    This displays all wind turbine models in the system. Use the search and filters below to find specific turbines.
    Each turbine model can be installed at multiple facilities with different configurations.
  </p>

  <!-- Search and Filter Form -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="get" class="row g-3">
        <div class="col-md-3">
          <label for="search" class="form-label">Search:</label>
          <input type="text" name="search" id="search" class="form-control" 
                 value="{{ search_query }}" placeholder="Search by model or manufacturer">
        </div>
        <div class="col-md-3">
          <label for="manufacturer" class="form-label">Manufacturer:</label>
          <select name="manufacturer" id="manufacturer" class="form-select">
            <option value="">All Manufacturers</option>
            {% for manufacturer in manufacturers %}
              <option value="{{ manufacturer }}" 
                      {% if manufacturer_filter == manufacturer %}selected{% endif %}>
                {{ manufacturer }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <label for="application" class="form-label">Application:</label>
          <select name="application" id="application" class="form-select">
            <option value="">All Applications</option>
            {% for value, label in applications %}
              <option value="{{ value }}" 
                      {% if application_filter == value %}selected{% endif %}>
                {{ label }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button type="submit" class="btn btn-primary me-2">Filter</button>
          <a href="{% url 'powermapui:wind_turbines_list' %}" class="btn btn-outline-secondary">Clear</a>
        </div>
        <div class="col-md-2 d-flex align-items-end justify-content-end">
          <small class="text-muted">{{ total_count }} turbine{{ total_count|pluralize }}</small>
        </div>
      </form>
    </div>
  </div>

  <!-- Results Table -->
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Model</th>
          <th>Manufacturer</th>
          <th>Application</th>
          <th>Rated Power (kW)</th>
          <th>Hub Height (m)</th>
          <th>Rotor Diameter (m)</th>
          <th>Cut-in Speed (m/s)</th>
          <th>Cut-out Speed (m/s)</th>
          <th>Installations</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for turbine in page_obj %}
          <tr>
            <td>
              <a href="{% url 'powermapui:wind_turbine_detail' turbine.pk %}" class="text-decoration-none">
                {{ turbine.turbine_model }}
              </a>
            </td>
            <td>{{ turbine.manufacturer|default:"-" }}</td>
            <td>
              {% if turbine.application %}
                <span class="badge bg-secondary">{{ turbine.get_application_display }}</span>
              {% else %}
                <span class="text-muted">-</span>
              {% endif %}
            </td>
            <td>
              {% if turbine.rated_power %}
                {{ turbine.rated_power|floatformat:0 }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if turbine.hub_height %}
                {{ turbine.hub_height|floatformat:1 }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if turbine.rotor_diameter %}
                {{ turbine.rotor_diameter|floatformat:1 }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if turbine.cut_in_speed %}
                {{ turbine.cut_in_speed|floatformat:1 }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              {% if turbine.cut_out_speed %}
                {{ turbine.cut_out_speed|floatformat:1 }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>
              <span class="badge bg-info">{{ turbine.get_total_installations }}</span>
            </td>
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <a href="{% url 'powermapui:wind_turbine_detail' turbine.pk %}" 
                   class="btn btn-outline-primary" title="View Details">
                  View
                </a>
                <a href="{% url 'powermapui:wind_turbine_edit' turbine.pk %}" 
                   class="btn btn-outline-warning" title="Edit">
                  Edit
                </a>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="10" class="text-center text-muted py-4">
              No wind turbines found.
              {% if search_query or manufacturer_filter or application_filter %}
                <a href="{% url 'powermapui:wind_turbines_list' %}" class="btn btn-link">Clear filters</a>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if page_obj.has_other_pages %}
    <nav aria-label="Wind turbines pagination">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if manufacturer_filter %}&manufacturer={{ manufacturer_filter }}{% endif %}{% if application_filter %}&application={{ application_filter }}{% endif %}">
              &laquo; First
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if manufacturer_filter %}&manufacturer={{ manufacturer_filter }}{% endif %}{% if application_filter %}&application={{ application_filter }}{% endif %}">
              Previous
            </a>
          </li>
        {% endif %}

        <li class="page-item active">
          <span class="page-link">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
          </span>
        </li>

        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if manufacturer_filter %}&manufacturer={{ manufacturer_filter }}{% endif %}{% if application_filter %}&application={{ application_filter }}{% endif %}">
              Next
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if manufacturer_filter %}&manufacturer={{ manufacturer_filter }}{% endif %}{% if application_filter %}&application={{ application_filter }}{% endif %}">
              Last &raquo;
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}

  <!-- Additional Actions -->
  <div class="mt-4">
    <a href="{% url 'powermapui:facility_wind_turbines_list' %}" class="btn btn-outline-secondary">
      View Facility Installations
    </a>
  </div>
{% endblock %}
