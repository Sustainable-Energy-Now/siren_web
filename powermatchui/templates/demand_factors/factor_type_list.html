{% extends 'powermatchui_base.html' %}
{% load static %}

{% block powermatchui_content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-12">
            <h3>Demand Factor Types</h3>
            <p class="text-muted">
                Factor types define categories of demand drivers (EV Adoption, Industrial Electrification, etc.).
                Create factor instances based on these types for specific scenarios.
            </p>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="row mb-3">
        <div class="col-md-6">
            <a href="{% url 'powermatchui:factor_type_create' %}" class="btn btn-primary">
                <i class="bi bi-plus-circle"></i> Create New Factor Type
            </a>
            <a href="{% url 'powermatchui:factor_list' %}" class="btn btn-secondary">
                <i class="bi bi-list-ul"></i> View Factor Instances
            </a>
        </div>
        <div class="col-md-6">
            <form method="get" class="d-flex justify-content-end">
                <input type="text" name="search" class="form-control me-2"
                       placeholder="Search factor types..."
                       value="{{ search_query }}" style="max-width: 300px;">
                <button type="submit" class="btn btn-outline-secondary">Search</button>
            </form>
        </div>
    </div>

    <!-- Factor Types Table -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    {% if factor_types %}
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Order</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Instances</th>
                                <th>System</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for factor_type in factor_types %}
                            <tr>
                                <td>{{ factor_type.display_order }}</td>
                                <td><strong>{{ factor_type.name }}</strong></td>
                                <td>
                                    {% if factor_type.category == 'operational' %}
                                        <span class="badge bg-info">Operational</span>
                                    {% elif factor_type.category == 'underlying' %}
                                        <span class="badge bg-warning">Underlying</span>
                                    {% else %}
                                        <span class="badge bg-success">Both</span>
                                    {% endif %}
                                </td>
                                <td>{{ factor_type.description|truncatewords:15 }}</td>
                                <td>
                                    <span class="badge bg-secondary">{{ factor_type.instance_count }}</span>
                                </td>
                                <td>
                                    {% if factor_type.is_system_default %}
                                        <i class="bi bi-check-circle-fill text-success" title="System default"></i>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="{% url 'powermatchui:factor_type_edit' factor_type.pk %}"
                                           class="btn btn-outline-primary" title="Edit">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        {% if factor_type.instance_count == 0 %}
                                        <form method="post"
                                              action="{% url 'powermatchui:factor_type_delete' factor_type.pk %}"
                                              style="display: inline;"
                                              onsubmit="return confirm('Delete factor type \'{{ factor_type.name }}\'?');">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-outline-danger" title="Delete">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </form>
                                        {% else %}
                                        <button class="btn btn-outline-secondary" disabled title="Has instances">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        No factor types found.
                        {% if search_query %}
                            Try a different search term or
                            <a href="{% url 'powermatchui:factor_type_list' %}">clear search</a>.
                        {% else %}
                            <a href="{% url 'powermatchui:factor_type_create' %}">Create your first factor type</a>.
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Help Text -->
    <div class="row mt-3">
        <div class="col-md-12">
            <div class="alert alert-secondary">
                <h6><i class="bi bi-question-circle"></i> About Factor Types</h6>
                <ul class="mb-0">
                    <li><strong>Operational</strong>: Demand sent to the grid (e.g., industrial loads, data centers)</li>
                    <li><strong>Underlying</strong>: Total consumption including distributed generation (e.g., rooftop solar offset)</li>
                    <li><strong>Both</strong>: Applies to both demand types (e.g., EV charging, residential)</li>
                    <li><strong>System</strong>: Default factor types provided by the system</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
